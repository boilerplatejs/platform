version: '3.5'

services:
  boilerplatejs_host:
    image: vitruviantech/boilerplatejs
    restart: unless-stopped
    command: npm run start
    working_dir: /app
    depends_on:
      - boilerplatejs_data
    volumes:
      # Environment
      - ./.env:/app/.env
      - ./.ssh:/app/.ssh
      - ./.pkg:/app/.pkg
      # Logs
      - ./log:/app/log
      # Dependencies
      - /app/node_modules
      - /app/.npm
      # Local Bundle Packages
      - /app/packages
      # Development Bundles
      - ${MNT0:-.mnt}:/mnt/0
      - ${MNT1:-.mnt}:/mnt/1
      - ${MNT2:-.mnt}:/mnt/2
      - ${MNT3:-.mnt}:/mnt/3
      - ${MNT4:-.mnt}:/mnt/4
      - ${MNT5:-.mnt}:/mnt/5
      - ${MNT6:-.mnt}:/mnt/6
      - ${MNT7:-.mnt}:/mnt/7
      - ${MNT8:-.mnt}:/mnt/8
      - ${MNT9:-.mnt}:/mnt/9
    environment:
      CONTAINER: 1
      LOG_LEVEL: ${LOG_LEVEL:-error}
      LICENSE: ${LICENSE:-}
      ENV: ${ENV:-}
      DEBUG: ${DEBUG:-}
      CONFIG: ${CONFIG:-}
      PORT: ${PORT:-8080}
      DB_HOST: ${DB_HOST:-boilerplatejs_data}
      DB_USER: ${DB_USER:-root}
      DB_PASSWORD: ${DB_PASSWORD:-root}
      DB_PORT: ${DB_PASSWORD:-3306}
      SERVICE_PROTOCOL: ${SERVICE_PROTOCOL:-}
      SERVICE_HOST: ${SERVICE_HOST:-}
      SERVICE_PORT: ${SERVICE_PORT:-}
      SERVICE_NAMESPACE: ${SERVICE_NAMESPACE:-}
      SOCKET_NAMESPACE: ${SOCKET_NAMESPACE:-}
      SESSION_SECRET: ${SESSION_SECRET:-}
      SESSION_MAX_AGE: ${SESSION_MAX_AGE:-}
    logging:
      options:
        max-size: ${LOGGING_OPTIONS_MAX_SIZE:-200k}
    ports:
      - "${IP:-0.0.0.0}:${PORT:-8080}:${PORT:-8080}"
      - "${IP:-0.0.0.0}:${BDS_PORT:-8081}:${BDS_PORT:-8081}"
      - "${IP:-0.0.0.0}:${WDS_PORT:-8082}:${WDS_PORT:-8082}"
    networks:
      boilerplatejs:
        aliases:
          - boilerplatejs_host

  boilerplatejs_data:
    image: mariadb
    restart: unless-stopped
    volumes:
      - /var/lib/mysql
    environment:
      MYSQL_ROOT_PASSWORD: ${DB_ROOT_PASSWORD:-root}
      MYSQL_USER: ${DB_USER:-boilerplate}
      MYSQL_PASSWORD: ${DB_PASSWORD:-root}
    logging:
      options:
        max-size: ${LOGGING_OPTIONS_MAX_SIZE:-200k}
    ports:
      - "${DB_PORT_EXTERNAL:-3306}:3306"
    networks:
      boilerplatejs:
        aliases:
          - boilerplatejs_data

networks:
  boilerplatejs: